# vim: set ft=zsh
if [[ "$PROFILE_ZSH_STARTUP" == true ]]; then
  zmodload zsh/zprof
fi

export DOT_BASE_DIR="$HOME/.dotfiles"
# export ZPLUG_HOME="$HOME/.dotfiles/third-party/zplug"
# source "$ZPLUG_HOME/init.zsh"

source "$DOT_BASE_DIR/third-party/antidote/antidote.zsh"
antidote load "$DOT_BASE_DIR/zsh/plugins.txt"

fpath=(~/.zsh/funcs "${fpath[@]}")

ZSH=$HOME/.zsh
export PATH="$HOME/.bun/bin:$HOME/.npm/bin:/opt/homebrew/opt/openjdk/bin:$PATH:$HOME/.local/bin"

HISTSIZE=10000
SAVEHIST=10000

HISTFILE="$HOME/.zsh_history"
mkdir -p "$(dirname "$HISTFILE")"

bindkey '^ ' autosuggest-accept
unsetopt beep
bindkey -e

autoload -Uz select-word-style
select-word-style bash

source ~/.zsh/prompt.zsh

autoload -U edit-command-line
zle -N edit-command-line
bindkey '\C-x\C-e' edit-command-line

export FZF_DEFAULT_COMMAND='fd --type f --strip-cwd-prefix --hidden --follow --exclude .git'

if [ -z "$VIM_VERSION" ]; then
  VIM_VERSION="nvim"
fi

export EDITOR="$VIM_VERSION"
export VISUAL="$VIM_VERSION"

alias vim="$VIM_VERSION"
alias vi="vim"

stty sane


# Load all libs under
for config_file in "$ZSH"/lib/*.zsh; do
  source "$config_file"
done

# completion settings
fpath=(~/.zsh/completion "${fpath[@]}")

autoload -Uz compinit
compinit -C

# zplug "zsh-users/zsh-autosuggestions"

# color theme
source "$ZSH/prompt.zsh"

# if [ -f /usr/share/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh ]; then
#   source /usr/share/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh
# fi
#
# if [ -f /usr/share/doc/git-extras/git-extras-completion.zsh ]; then
#   source /usr/share/doc/git-extras/git-extras-completion.zsh
# fi
#
# if [ -f /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh ]; then
#   source /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh
# fi

export XDG_CONFIG_HOME="$HOME/.config"
export LC_ALL=en_US.UTF-8

autoload -Uz $(print ~/.dotfiles/zsh/funcs/*(:t))

LOCAL_PATHS="/usr/local/bin:/usr/local/sbin"

export PATH="$HOME/.todo/bin:$HOME/.emacs.d/bin:$HOME/.dotfiles/bin:$LOCAL_PATHS:$PATH"

# Base16 Shell
# BASE16_SHELL="$HOME/.config/base16-shell/"
# if [ -n "$PS1" ] && [ -s "$BASE16_SHELL/profile_helper.sh" ]; then
#   eval "$("$BASE16_SHELL/profile_helper.sh")"
# fi
# base16_default-dark

if [ ! -S ~/.ssh/ssh_auth_sock ]; then
  eval `ssh-agent`
  ln -sf "$SSH_AUTH_SOCK" ~/.ssh/ssh_auth_sock
fi

export SSH_AUTH_SOCK=~/.ssh/ssh_auth_sock
ssh-add -l > /dev/null || ssh-add

export PATH="./node_modules/.bin:$HOME/.cargo/bin:$PATH"

if type rustc &>/dev/null; then
  export RUST_SRC_PATH=$(rustc --print sysroot)/lib/rustlib/src/rust/library/
fi

export QT_STYLE_OVERRIDE=adwaita-dark

export LOCALE_ARCHIVE=/usr/lib/locale/locale-archive

export CARGO_NET_GIT_FETCH_WITH_CLI=true

if [[ `uname` == "Darwin" ]]; then
  export TERM=xterm-256color

  [ -f /opt/homebrew/bin/brew ] && eval "$(/opt/homebrew/bin/brew shellenv)"

  export LLVM_SYS_150_PREFIX=$HOME/projects/llvm-15-bin/
  export LLVM_SYS_160_PREFIX=$HOME/builds/llvm/prefix_release/
else
  # export LLVM_SYS_150_PREFIX=$HOME/gen/llvm-bin-release-15.0.7
  export LLVM_SYS_150_PREFIX=$HOME/gen/llvm-bin-15.0.7
  export LLVM_SYS_160_DEBUG_PREFIX=$HOME/gen/llvm-bin-16.0.6
  export LLVM_SYS_160_RELEASE_PREFIX=$HOME/gen/llvm-release-bin-16.0.6
fi

export HOMEBREW_NO_AUTO_UPDATE=1
export HOMEBREW_NO_INSTALL_CLEANUP=1
